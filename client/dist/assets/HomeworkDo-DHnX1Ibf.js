import{_ as X,r as D,W as Y,m as Z,i as I,c as l,b as U,n as f,p as i,w as m,e as _,T as q,E as g,f as ee,o,d as n,y as u,F as A,x as E,h as b,a1 as J,a2 as se,R as te,a3 as ae,a4 as oe}from"./index-ChKRIHQI.js";import{g as re}from"./file-bq74KdpQ.js";import{v as ne}from"./v4-C6aID195.js";const le={class:"homework-do-container"},ie={class:"text-large font-600 mr-3"},ce={class:"card-header"},de={class:"questions-list"},ue={class:"question-title"},pe={key:0,class:"correctness-indicator"},me={key:0},_e={key:0,class:"answer-info"},ve={key:0,class:"submitted-answer"},fe={class:"correct-answer-text"},we={key:1},he=["innerHTML"],ye={key:1,class:"attachment"},ke=["href"],ge={class:"answer-section"},be={class:"upload-container"},xe={key:1,class:"file-name"},Ce=["href"],Te={key:2,class:"correct-answer-section"},Se=["innerHTML"],De={key:1,class:"attachment"},Ue=["href"],Ve={key:0,class:"submission-actions"},He={__name:"HomeworkDo",setup(Ne){const $=Y(),R=ee(),N=D($.params.id),x=D(!0),d=D(null),c=D({}),p=Z(()=>{var t,e,r,a;return((e=(t=d.value)==null?void 0:t.submission)==null?void 0:e.status)===2||((a=(r=d.value)==null?void 0:r.submission)==null?void 0:a.status)===3}),z=t=>{var r,a;if(!((r=d.value)!=null&&r.submission)||t.questionType!=="choice")return!1;const e=c.value[t.id];return(e==null?void 0:e.toLowerCase())===((a=t.answer)==null?void 0:a.toLowerCase())},C=t=>{var e,r;if(!((r=(e=d.value)==null?void 0:e.submission)!=null&&r.answers))return null;try{const a=JSON.parse(d.value.submission.answers);for(const[y,w]of Object.entries(a))if(y===String(t))return w;return null}catch(a){return console.warn("解析提交答案失败:",a),null}},T=t=>{try{return JSON.parse(t.options)||{}}catch{return{}}},h=t=>{try{return JSON.parse(t.answer)||{}}catch{return{}}},F=t=>typeof t!="string"?"":t.replace(/\\n/g,"<br>"),B=D({domain:"http://sxh8oib6z.hb-bkt.clouddn.com",uploadUrl:"http://upload-z1.qiniup.com"}),j=async({file:t},e)=>{try{const r=await re(),a=t.name.split(".").pop()||"tmp",y=`homework/${ne()}.${a}`,w=new FormData;w.append("token",r),w.append("key",y),w.append("file",t);const H=await te.post(B.value.uploadUrl,w),V={url:`${B.value.domain}/${H.data.key}`,name:t.name};let v=c.value[e];typeof v=="string"?v={text:v}:v||(v={}),v.file=V,c.value[e]=v,g.success("文件上传成功")}catch{g.error("上传失败，请重试")}},L=async()=>{var t;x.value=!0;try{const e=await q(N.value);if(d.value=e,e.questions){const r={};if(e.questions.forEach(a=>{if(a.questionType==="choice"&&typeof a.options=="string")try{a.options=JSON.parse(a.options)}catch(y){console.warn("选项解析失败:",y),a.options=[]}a.questionType==="choice"?r[a.id]="":r[a.id]={text:"",file:null}}),p.value&&((t=d.value.submission)!=null&&t.answers))try{const a=JSON.parse(d.value.submission.answers);c.value={...r,...a}}catch(a){console.warn("提交答案解析失败:",a),c.value=r}else c.value=r}}catch(e){g.error("获取作业详情失败"),console.error(e)}finally{x.value=!1}},W=()=>{ae.confirm("确认要提交作业吗？提交后将无法修改。","提示",{confirmButtonText:"确认提交",cancelButtonText:"再检查一下",type:"warning"}).then(async()=>{try{const t={homeworkId:N.value,answers:c.value};await oe(t),g.success("作业提交成功！"),L()}catch(t){g.error("提交失败，请稍后重试"),console.error("Submission error:",t)}}).catch(()=>{g.info("已取消提交")})},G=()=>{R.back()};return I(L),(t,e)=>{const r=_("el-page-header"),a=_("el-tag"),y=_("el-radio"),w=_("el-radio-group"),H=_("el-input"),V=_("el-button"),v=_("el-upload"),M=_("el-empty"),K=_("el-card"),P=_("el-skeleton");return o(),l("div",le,[U(r,{onBack:G,class:"page-header"},{content:m(()=>[n("span",ie,u(p.value?"查看作业":"作业作答"),1)]),_:1}),!x.value&&d.value?(o(),f(K,{key:0,class:"homework-card"},{header:m(()=>[n("div",ce,[n("h2",null,u(d.value.homework.title),1),n("p",null,"截止时间："+u(d.value.homework.endTime),1)])]),default:m(()=>[n("div",de,[(o(!0),l(A,null,E(d.value.questions,(s,Q)=>{var O;return o(),l("div",{key:s.id,class:"question-item"},[n("h4",ue,[n("span",null,u(Q+1)+". "+u(s.questionText)+" ("+u(s.score)+"分)",1),p.value&&s.questionType==="choice"?(o(),l("span",pe,[z(s)?(o(),f(a,{key:0,type:"success",effect:"dark"},{default:m(()=>e[0]||(e[0]=[b("回答正确")])),_:1,__:[0]})):(o(),f(a,{key:1,type:"danger",effect:"dark"},{default:m(()=>e[1]||(e[1]=[b("回答错误")])),_:1,__:[1]}))])):i("",!0)]),s.questionType==="choice"?(o(),l("div",me,[U(w,{modelValue:c.value[s.id],"onUpdate:modelValue":k=>c.value[s.id]=k,disabled:p.value},{default:m(()=>[(o(!0),l(A,null,E(s.options,(k,S)=>(o(),f(y,{key:S,label:String.fromCharCode(65+S),class:J(["choice-radio",{"correct-answer":p.value&&String.fromCharCode(65+S)===s.answer,"wrong-answer":p.value&&C(s.id)===String.fromCharCode(65+S)&&C(s.id)!==s.answer}])},{default:m(()=>[b(u(String.fromCharCode(65+S))+". "+u(k.text),1)]),_:2},1032,["label","class"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),p.value?(o(),l("div",_e,[C(s.id)?(o(),l("div",ve,[e[2]||(e[2]=b(" 你的答案：")),n("span",{class:J({"text-danger":C(s.id)!==s.answer})},u(C(s.id)),3)])):i("",!0),n("div",fe," 正确答案："+u(s.answer),1)])):i("",!0)])):(o(),l("div",we,[T(s).description?(o(),l("div",{key:0,class:"question-description",innerHTML:F(T(s).description)},null,8,he)):i("",!0),T(s).questionFileUrl?(o(),l("div",ye,[e[3]||(e[3]=n("strong",null,"题目附件: ",-1)),n("a",{href:T(s).questionFileUrl,target:"_blank"},u(T(s).questionFileName||"点击下载"),9,ke)])):i("",!0),n("div",ge,[U(H,{type:"textarea",rows:8,placeholder:"请在此处输入你的代码或答案",modelValue:c.value[s.id].text,"onUpdate:modelValue":k=>c.value[s.id].text=k,disabled:p.value,class:"answer-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"]),n("div",be,[p.value?i("",!0):(o(),f(v,{key:0,"http-request":k=>j(k,s.id),"show-file-list":!1,limit:1,class:"upload-component"},{default:m(()=>[U(V,{type:"primary"},{default:m(()=>e[4]||(e[4]=[b("上传答案文件")])),_:1,__:[4]})]),_:2},1032,["http-request"])),e[5]||(e[5]=n("br",null,null,-1)),(O=c.value[s.id])!=null&&O.file?(o(),l("span",xe,[n("a",{href:c.value[s.id].file.url,target:"_blank"},u(c.value[s.id].file.name),9,Ce)])):i("",!0)])]),p.value?(o(),l("div",Te,[e[7]||(e[7]=n("h4",null,"参考答案",-1)),h(s).answerDescription?(o(),l("div",{key:0,innerHTML:F(h(s).answerDescription),class:"answer-description"},null,8,Se)):i("",!0),h(s).answerFileUrl?(o(),l("div",De,[e[6]||(e[6]=n("strong",null,"答案附件: ",-1)),n("a",{href:h(s).answerFileUrl,target:"_blank"},u(h(s).answerFileName||"点击下载"),9,Ue)])):i("",!0),!h(s).answerDescription&&!h(s).answerFileUrl?(o(),f(M,{key:2,description:"该题没有提供参考答案"})):i("",!0)])):i("",!0)]))])}),128))]),p.value?i("",!0):(o(),l("div",Ve,[U(V,{type:"primary",onClick:W},{default:m(()=>e[8]||(e[8]=[b("提交作业")])),_:1,__:[8]})]))]),_:1})):i("",!0),x.value?(o(),f(P,{key:1,rows:10,animated:""})):i("",!0),!x.value&&!d.value?(o(),f(M,{key:2,description:"作业加载失败或不存在"})):i("",!0),p.value?(o(),f(se,{key:3})):i("",!0)])}}},Me=X(He,[["__scopeId","data-v-145c0e8d"]]);export{Me as default};
