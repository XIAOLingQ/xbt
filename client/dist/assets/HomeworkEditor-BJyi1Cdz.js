import{_ as M,m as D,e as u,c as b,o as f,b as o,w as t,F as Q,x as z,n as E,h as k,y as C,r as $,I as H,d as _,p as A,E as x,j as L,i as K,T as W,f as X,U as Z,q as P,v as R,V as ee}from"./index-BDXlMFXp.js";import{v as B}from"./v4-C6aID195.js";const oe={class:"choice-editor"},te={__name:"ChoiceEditor",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(N,{emit:T}){const p=N,n=T,r=D({get:()=>p.modelValue,set:v=>{n("update:modelValue",v)}}),g=()=>{r.value.options||(r.value.options=[]),r.value.options.push({text:""})},V=v=>{r.value.options.splice(v,1)};return(v,m)=>{const q=u("el-input"),y=u("el-form-item"),U=u("el-button"),s=u("el-radio"),a=u("el-radio-group"),c=u("el-input-number"),l=u("el-form");return f(),b("div",oe,[o(l,{model:r.value,"label-width":"80px"},{default:t(()=>[o(y,{label:"题目内容"},{default:t(()=>[o(q,{modelValue:r.value.questionText,"onUpdate:modelValue":m[0]||(m[0]=e=>r.value.questionText=e),type:"textarea",autosize:"",placeholder:"请输入题目内容"},null,8,["modelValue"])]),_:1}),(f(!0),b(Q,null,z(r.value.options,(e,i)=>(f(),E(y,{key:i,label:"选项 "+String.fromCharCode(65+i)},{default:t(()=>[o(q,{modelValue:e.text,"onUpdate:modelValue":d=>e.text=d,placeholder:"请输入选项内容",style:{width:"80%","margin-right":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),o(U,{type:"danger",size:"small",onClick:d=>V(i)},{default:t(()=>m[3]||(m[3]=[k("删除")])),_:2,__:[3]},1032,["onClick"])]),_:2},1032,["label"]))),128)),o(y,null,{default:t(()=>[o(U,{type:"primary",plain:"",onClick:g},{default:t(()=>m[4]||(m[4]=[k("添加选项")])),_:1,__:[4]})]),_:1}),o(y,{label:"正确答案"},{default:t(()=>[o(a,{modelValue:r.value.answer,"onUpdate:modelValue":m[1]||(m[1]=e=>r.value.answer=e)},{default:t(()=>[(f(!0),b(Q,null,z(r.value.options,(e,i)=>(f(),E(s,{key:i,label:String.fromCharCode(65+i)},{default:t(()=>[k(C(String.fromCharCode(65+i)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(y,{label:"分值"},{default:t(()=>[o(c,{modelValue:r.value.score,"onUpdate:modelValue":m[2]||(m[2]=e=>r.value.score=e),min:1,max:100},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])}}},le=M(te,[["__scopeId","data-v-e901108e"]]),ne={class:"programming-editor"},ae={class:"upload-container"},se={key:0,class:"file-name"},re=["href"],ue={class:"upload-container"},ie={key:0,class:"file-name"},de=["href"],pe={__name:"ProgrammingEditor",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(N,{emit:T}){const p=N,n=T,r=$({domain:"http://sxh8oib6z.hb-bkt.clouddn.com",uploadUrl:"http://upload-z1.qiniup.com",token:"",key:""}),g=$(""),V=$(""),v=(l,e)=>{n("update:modelValue",{...p.modelValue,[l]:e})},m=l=>{try{const i={...p.modelValue.options?JSON.parse(p.modelValue.options):{},...l},d=JSON.stringify(i);d!==p.modelValue.options&&v("options",d)}catch{v("options",JSON.stringify(l))}};H(()=>p.modelValue.options,l=>{try{const e=l?JSON.parse(l):{};g.value=e.description||"",V.value=e.answerDescription||""}catch{g.value="",V.value=""}},{immediate:!0}),H(g,l=>m({description:l})),H(V,l=>m({answerDescription:l}));const q=D(()=>{try{const l=p.modelValue.options?JSON.parse(p.modelValue.options):{};if(l.questionFileUrl)return[{name:l.questionFileName,url:l.questionFileUrl,status:"success"}]}catch{}return[]}),y=D(()=>{try{const l=p.modelValue.answer?JSON.parse(p.modelValue.answer):{};if(l.answerFileUrl)return[{name:l.answerFileName,url:l.answerFileUrl,status:"success"}]}catch{}return[]}),U=async l=>{try{const e=await L(),i=await L();r.value.token=i;const d=l.name.split(".").pop()||"tmp";return r.value.key=`homework/${B()}.${d}`,!0}catch{return x.error("获取上传凭证失败"),!1}},s=(l,e)=>{m({questionFileUrl:`${r.value.domain}/${l.key}`,questionFileName:e.name}),x.success("题目附件上传成功")},a=(l,e)=>{const i={answerFileUrl:`${r.value.domain}/${l.key}`,answerFileName:e.name};v("answer",JSON.stringify(i)),x.success("答案附件上传成功")},c=()=>{x.error("上传失败，请检查网络或联系管理员")};return(l,e)=>{const i=u("el-input"),d=u("el-form-item"),S=u("el-button"),F=u("el-upload"),I=u("el-input-number"),J=u("el-form");return f(),b("div",ne,[o(J,{model:p.modelValue,"label-width":"80px"},{default:t(()=>[o(d,{label:"题目内容"},{default:t(()=>[o(i,{"model-value":p.modelValue.questionText,"onUpdate:modelValue":e[0]||(e[0]=w=>v("questionText",w)),type:"textarea",autosize:"",placeholder:"请输入题目内容"},null,8,["model-value"])]),_:1}),o(d,{label:"题目描述"},{default:t(()=>[o(i,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=w=>g.value=w),type:"textarea",rows:5,placeholder:"请输入题目详细描述"},null,8,["modelValue"])]),_:1}),o(d,{label:"题目附件 (可选)"},{default:t(()=>[_("div",ae,[o(F,{action:r.value.uploadUrl,data:r.value,"before-upload":U,"on-success":s,"on-error":c,"show-file-list":!1,limit:1,class:"upload-component"},{default:t(()=>[o(S,{type:"primary"},{default:t(()=>e[4]||(e[4]=[k("点击上传")])),_:1,__:[4]})]),_:1},8,["action","data"]),e[5]||(e[5]=_("br",null,null,-1)),q.value.length>0?(f(),b("span",se,[_("a",{href:q.value[0].url,target:"_blank"},C(q.value[0].name),9,re)])):A("",!0)]),e[6]||(e[6]=_("div",{class:"el-upload__tip"}," 只能上传一个文件，新文件会覆盖旧文件。 ",-1))]),_:1,__:[6]}),o(d,{label:"参考答案描述"},{default:t(()=>[o(i,{type:"textarea",rows:5,modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=w=>V.value=w),placeholder:"请填写文字版参考答案..."},null,8,["modelValue"])]),_:1}),o(d,{label:"答案附件 (可选)"},{default:t(()=>[_("div",ue,[o(F,{action:r.value.uploadUrl,data:r.value,"before-upload":U,"on-success":a,"on-error":c,"show-file-list":!1,limit:1,class:"upload-component"},{default:t(()=>[o(S,{type:"primary"},{default:t(()=>e[7]||(e[7]=[k("点击上传")])),_:1,__:[7]})]),_:1},8,["action","data"]),y.value.length>0?(f(),b("span",ie,[_("a",{href:y.value[0].url,target:"_blank"},C(y.value[0].name),9,de)])):A("",!0)]),e[8]||(e[8]=_("div",{class:"el-upload__tip"}," 只能上传一个文件，新文件会覆盖旧文件。 ",-1))]),_:1,__:[8]}),o(d,{label:"分值"},{default:t(()=>[o(I,{"model-value":p.modelValue.score,"onUpdate:modelValue":e[3]||(e[3]=w=>v("score",w)),min:1,max:100},null,8,["model-value"])]),_:1})]),_:1},8,["model"])])}}},me=M(pe,[["__scopeId","data-v-f9fbaca7"]]),ce={class:"homework-editor-container"},_e={class:"card-header"},fe={class:"main-content"},ve={class:"card-header"},ye={class:"add-question-buttons"},we={__name:"HomeworkEditor",props:{courseId:{type:String,required:!0},homeworkId:{type:String,required:!0}},setup(N){const T=N,p=X(),n=$({title:"",questions:[]}),r=D({get(){return n.value.startTime&&n.value.endTime?[n.value.startTime,n.value.endTime]:[]},set(s){s&&s.length===2?(n.value.startTime=s[0],n.value.endTime=s[1]):(n.value.startTime=null,n.value.endTime=null)}});K(()=>{T.homeworkId!=="new"&&g()});const g=async()=>{try{const s=await W(T.homeworkId),a=s.homework,l=(s.questions||[]).map(e=>{if(e.questionType==="choice"&&typeof e.options=="string")try{e.options=JSON.parse(e.options)}catch{console.error("Failed to parse options for question:",e),e.options=[]}return e});n.value={...a,questions:l}}catch(s){x.error("加载作业信息失败"),console.error(s)}},V=()=>{p.push({name:"CourseManage",params:{courseId:T.courseId},query:{tab:"homework"}})},v=async()=>{try{const s={id:n.value.id,courseId:n.value.courseId,title:n.value.title,description:n.value.description,startTime:n.value.startTime,endTime:n.value.endTime,answer:n.value.answer,questions:(n.value.questions||[]).map(a=>{const c=JSON.parse(JSON.stringify(a));return typeof c.id=="string"&&(c.id=null),c.questionType==="choice"&&Array.isArray(c.options)&&(c.options=JSON.stringify(c.options)),c})};await ee(s),x.success("作业保存成功!")}catch(s){x.error("保存失败"),console.error(s)}},m=s=>s==="choice"?"选择题":s==="programming"?"编程题":"未知题型",q=s=>s==="choice"?le:s==="programming"?me:null,y=s=>{let a;s==="choice"?a={id:B(),questionType:"choice",questionText:"新的选择题",options:[{text:""},{text:""},{text:""},{text:""}],answer:"A",score:5}:a={id:B(),questionType:"programming",questionText:"新的编程题",description:"",questionFileName:"",questionFileUrl:"",answerDescription:"",answerFileName:"",answerFileUrl:"",score:10},n.value.questions||(n.value.questions=[]),n.value.questions.push(a)},U=s=>{n.value.questions.splice(s,1)};return(s,a)=>{const c=u("el-page-header"),l=u("el-button"),e=u("el-alert"),i=u("el-input"),d=u("el-form-item"),S=u("el-col"),F=u("el-date-picker"),I=u("el-row"),J=u("el-form"),w=u("el-card"),G=u("el-empty"),Y=u("el-icon");return f(),b("div",ce,[o(c,{onBack:V,class:"page-header"},{content:t(()=>a[4]||(a[4]=[_("span",{class:"text-large font-600 mr-3"}," 作业编辑器 ",-1)])),_:1}),o(w,null,{header:t(()=>[_("div",_e,[_("span",null,C(n.value.title||"加载中..."),1),o(l,{type:"primary",onClick:v},{default:t(()=>a[5]||(a[5]=[k("保存全部修改")])),_:1,__:[5]})])]),default:t(()=>[o(e,{title:"此页面下的所有修改，都需要点击右上角的'保存全部修改'按钮才会生效。",type:"info","show-icon":"",closable:!1}),o(J,{model:n.value,"label-width":"100px",class:"homework-info-form"},{default:t(()=>[o(I,null,{default:t(()=>[o(S,{span:12},{default:t(()=>[o(d,{label:"作业标题"},{default:t(()=>[o(i,{modelValue:n.value.title,"onUpdate:modelValue":a[0]||(a[0]=h=>n.value.title=h),placeholder:"请输入作业标题"},null,8,["modelValue"])]),_:1})]),_:1}),o(S,{span:12},{default:t(()=>[o(d,{label:"作业时间"},{default:t(()=>[o(F,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=h=>r.value=h),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},"value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),_("div",fe,[(f(!0),b(Q,null,z(n.value.questions,(h,O)=>(f(),b("div",{key:h.id,class:"question-item"},[o(w,{class:"question-card"},{header:t(()=>[_("div",ve,[_("span",null,"第 "+C(O+1)+" 题 ("+C(m(h.questionType))+")",1),o(l,{type:"danger",size:"small",onClick:j=>U(O)},{default:t(()=>a[6]||(a[6]=[k("删除")])),_:2,__:[6]},1032,["onClick"])])]),default:t(()=>[(f(),E(Z(q(h.questionType)),{modelValue:n.value.questions[O],"onUpdate:modelValue":j=>n.value.questions[O]=j},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]))),128)),!n.value.questions||n.value.questions.length===0?(f(),E(G,{key:0,description:"该作业下暂无题目"})):A("",!0),_("div",ye,[o(l,{type:"primary",plain:"",onClick:a[2]||(a[2]=h=>y("choice"))},{default:t(()=>[o(Y,null,{default:t(()=>[o(P(R))]),_:1}),a[7]||(a[7]=k(" 添加选择题 "))]),_:1,__:[7]}),o(l,{type:"success",plain:"",onClick:a[3]||(a[3]=h=>y("programming"))},{default:t(()=>[o(Y,null,{default:t(()=>[o(P(R))]),_:1}),a[8]||(a[8]=k(" 添加编程题 "))]),_:1,__:[8]})])])]),_:1})])}}},he=M(we,[["__scopeId","data-v-eb673fb0"]]);export{he as default};
