import{_ as D,r as d,c as w,b as t,e as s,w as o,f as M,o as b,d as k,n as P,q as R,v as z,h as C,l as E,E as c,R as O,S as j}from"./index-ChKRIHQI.js";import{g as G}from"./file-bq74KdpQ.js";const H={class:"create-course-container"},J=["src"],T="http://sxh8oib6z.hb-bkt.clouddn.com",A={__name:"CreateCourse",setup(L){const y=M(),m=d(null),_=d(!1),I=async a=>{await E(a)},h={background:{color:{value:"transparent"}},particles:{number:{value:80},color:{value:"#6996f8"},shape:{type:"circle"},opacity:{value:.7},size:{value:3,random:!0},links:{enable:!0,color:"#6996f8",distance:120,opacity:.5,width:1},move:{enable:!0,speed:2,direction:"none",random:!0,straight:!1,out_mode:"out"}},interactivity:{events:{onHover:{enable:!0,mode:"grab"},onClick:{enable:!0,mode:"push"}}}},x=d({uploadUrl:"http://upload-z1.qiniup.com"}),l=d({title:"",description:"",coverImage:""}),V={title:[{required:!0,message:"请输入课程标题",trigger:"blur"}],description:[{required:!0,message:"请输入课程描述",trigger:"blur"}]},B=()=>{y.back()},F=async({file:a})=>{const e=a.type==="image/jpeg"||a.type==="image/png",f=a.size/1024/1024<2;if(!e){c.error("封面图片只能是 JPG/PNG 格式!");return}if(!f){c.error("封面图片大小不能超过 2MB!");return}try{const u=await G(),i=a.name.split(".").pop()||"png",r=`course-covers/temp_${Date.now()}.${i}`,n=new FormData;n.append("token",u),n.append("key",r),n.append("file",a);const v=await O.post(x.value.uploadUrl,n),p=`${T}/${v.data.key}`;l.value.coverImage=p,c.success("封面上传成功!")}catch(u){console.error("Upload failed:",u),c.error("上传失败，请重试")}},U=()=>{m.value.validate(async a=>{if(a){_.value=!0;try{const e=await j(l.value);c.success(`课程《${e.title}》创建成功！课程码为：${e.courseCode}`),y.push("/")}catch(e){c.error(e.message||"创建失败")}finally{_.value=!1}}else return!1})},q=()=>{m.value.resetFields()};return(a,e)=>{const f=s("Particles"),u=s("el-page-header"),i=s("el-input"),r=s("el-form-item"),n=s("el-icon"),v=s("el-upload"),p=s("el-button"),N=s("el-form"),$=s("el-card");return b(),w("div",H,[t(f,{id:"tsparticles",class:"course-bg",particlesInit:I,options:h}),t(u,{onBack:B,class:"page-header"},{content:o(()=>e[2]||(e[2]=[k("span",{class:"page-title"},"创建新课程",-1)])),_:1}),t($,{class:"form-card"},{default:o(()=>[t(N,{model:l.value,rules:V,ref_key:"courseFormRef",ref:m,"label-width":"100px"},{default:o(()=>[t(r,{label:"课程标题",prop:"title"},{default:o(()=>[t(i,{modelValue:l.value.title,"onUpdate:modelValue":e[0]||(e[0]=g=>l.value.title=g),placeholder:"请输入课程标题"},null,8,["modelValue"])]),_:1}),t(r,{label:"课程描述",prop:"description"},{default:o(()=>[t(i,{type:"textarea",rows:4,modelValue:l.value.description,"onUpdate:modelValue":e[1]||(e[1]=g=>l.value.description=g),placeholder:"请输入课程描述"},null,8,["modelValue"])]),_:1}),t(r,{label:"课程封面",prop:"coverImage"},{default:o(()=>[t(v,{class:"cover-uploader","show-file-list":!1,"http-request":F},{default:o(()=>[l.value.coverImage?(b(),w("img",{key:0,src:l.value.coverImage,class:"cover-image"},null,8,J)):(b(),P(n,{key:1,class:"cover-uploader-icon"},{default:o(()=>[t(R(z))]),_:1}))]),_:1}),e[3]||(e[3]=k("br",null,null,-1)),e[4]||(e[4]=k("div",{class:"el-upload__tip"}," 只能上传jpg/png文件，且不超过2MB ",-1))]),_:1,__:[3,4]}),t(r,null,{default:o(()=>[t(p,{type:"primary",onClick:U,loading:_.value},{default:o(()=>e[5]||(e[5]=[C("立即创建")])),_:1,__:[5]},8,["loading"]),t(p,{onClick:q},{default:o(()=>e[6]||(e[6]=[C("重置")])),_:1,__:[6]})]),_:1})]),_:1},8,["model"])]),_:1})])}}},K=D(A,[["__scopeId","data-v-b94c736e"]]);export{K as default};
