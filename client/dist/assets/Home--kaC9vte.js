import{_ as ue,f as _e,u as ie,r as c,i as ve,j as pe,E as _,k as xe,m as fe,e as n,c as f,o as r,d as s,n as y,p as k,b as t,w as o,q as C,s as me,t as ye,v as ee,h as m,F as X,x as re,y as v,g as W,z as Ve,A as $e,C as Ie,B as De,D as Se,G as Te,H as Ue,I as Le,J as He,K as Me,L as Ne,M as Ae,N as ze,O as Ee,P as Je,Q as Oe}from"./index-BDXlMFXp.js";const qe={class:"home-container"},Be={class:"content-wrapper"},Fe={key:0},Re={class:"section-header"},Ge={class:"actions"},Qe=["src"],je={class:"course-info"},Pe={class:"teacher course-code-container"},Ke={class:"course-stats"},We={class:"card-footer"},Xe=["src"],Ye={class:"dialog-footer"},Ze="http://sxh8oib6z.hb-bkt.clouddn.com",et={__name:"TeacherHome",setup(de){const S=_e();ie();const h=c("courses"),b=c(""),T=c([]),w=c(!1),d=c(null),x=c(!1),U=c({token:"",key:"",uploadUrl:"http://upload-z1.qiniup.com"});ve(()=>{V(),O()});const O=async()=>{try{const u=await pe(),l=await pe();U.value.token=l}catch{_.error("获取上传凭证失败")}},V=async()=>{try{const u=await xe({page:1,size:10});T.value=u.list}catch(u){_.error("获取课程列表失败"),console.error(u)}},L=fe(()=>{if(!b.value)return T.value;const u=b.value.toLowerCase();return T.value.filter(l=>l.title.toLowerCase().includes(u))}),M=u=>{h.value=u},G=()=>{S.push("/course/create")},N=u=>{d.value=JSON.parse(JSON.stringify(u)),w.value=!0},Q=async()=>{if(d.value){x.value=!0;try{await Se(d.value),_.success("课程信息更新成功"),w.value=!1,await V()}catch(u){_.error(u.message||"更新失败")}finally{x.value=!1}}},A=async u=>{try{await De(u),_.success("课程删除成功"),V()}catch(l){_.error(l.message||"删除失败")}},z=async u=>{if(!U.value.token&&(_.error("上传凭证获取失败，请重试"),await O(),!U.value.token))return!1;const l=u.name.split(".").pop()||"png";return U.value.key=`course-covers/${d.value.id}_${Date.now()}.${l}`,!0},q=u=>{const l=`${Ze}/${u.key}`;d.value&&(d.value.coverImage=l),_.success("封面上传成功!")},te=u=>{S.push(`/course/manage/${u}`)},j=async u=>{if(u)try{await navigator.clipboard.writeText(u),_.success("课程码已复制")}catch{_.error("复制失败，您的浏览器可能不支持该功能")}};return(u,l)=>{const B=n("el-icon"),P=n("el-menu-item"),oe=n("el-menu"),se=n("el-aside"),F=n("el-input"),H=n("el-button"),le=n("el-tooltip"),ae=n("el-popconfirm"),Y=n("el-card"),a=n("el-col"),e=n("el-row"),I=n("el-empty"),E=n("el-main"),g=n("el-form-item"),J=n("el-upload"),K=n("el-form"),D=n("el-dialog");return r(),f(X,null,[s("div",qe,[s("div",Be,[t(se,{width:"240px",class:"sidebar"},{default:o(()=>[t(oe,{"default-active":h.value,class:"menu",onSelect:M},{default:o(()=>[t(P,{index:"courses"},{default:o(()=>[t(B,null,{default:o(()=>[t(C(me))]),_:1}),l[6]||(l[6]=s("span",null,"我教的课程",-1))]),_:1,__:[6]})]),_:1},8,["default-active"])]),_:1}),t(E,{class:"main-content"},{default:o(()=>[h.value==="courses"?(r(),f("div",Fe,[s("div",Re,[l[8]||(l[8]=s("h2",null,"课程管理",-1)),s("div",Ge,[t(F,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=p=>b.value=p),placeholder:"搜索课程",class:"search-input","prefix-icon":C(ye),clearable:""},null,8,["modelValue","prefix-icon"]),t(H,{type:"primary",icon:C(ee),onClick:G},{default:o(()=>l[7]||(l[7]=[m("创建课程")])),_:1,__:[7]},8,["icon"])])]),L.value.length>0?(r(),y(e,{key:0,gutter:20},{default:o(()=>[(r(!0),f(X,null,re(L.value,p=>(r(),y(a,{span:6,key:p.id},{default:o(()=>[t(Y,{class:"course-card","body-style":{padding:"0px"},onClick:$=>te(p.id)},{default:o(()=>[s("img",{src:p.coverImage,class:"course-image"},null,8,Qe),s("div",je,[s("h3",null,v(p.title),1),s("div",Pe,[s("span",null,"课程码: "+v(p.courseCode),1),t(le,{content:"复制课程码",placement:"top"},{default:o(()=>[t(B,{class:"copy-icon",onClick:W($=>j(p.courseCode),["stop"])},{default:o(()=>[t(C(Ve))]),_:2},1032,["onClick"])]),_:2},1024)]),s("div",Ke,[t(B,null,{default:o(()=>[t(C($e))]),_:1}),s("span",null,v(p.studentCount)+" 人报名",1)])]),s("div",We,[t(H,{type:"primary",link:"",class:"action-btn",onClick:W($=>N(p),["stop"])},{default:o(()=>l[9]||(l[9]=[m("编辑信息")])),_:2,__:[9]},1032,["onClick"]),t(H,{type:"primary",link:"",class:"action-btn"},{default:o(()=>l[10]||(l[10]=[m("内容管理")])),_:1,__:[10]}),t(ae,{title:"确定要删除这门课程吗？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:W($=>A(p.id),["stop"])},{reference:o(()=>[t(H,{type:"danger",link:"",class:"action-btn",onClick:l[1]||(l[1]=W(()=>{},["stop"]))},{default:o(()=>l[11]||(l[11]=[m("删除")])),_:1,__:[11]})]),_:2},1032,["onConfirm"])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})):(r(),y(I,{key:1,description:"暂无课程"}))])):k("",!0)]),_:1})]),t(D,{modelValue:w.value,"onUpdate:modelValue":l[5]||(l[5]=p=>w.value=p),title:"编辑课程信息",width:"600px"},{footer:o(()=>[s("span",Ye,[t(H,{onClick:l[4]||(l[4]=p=>w.value=!1)},{default:o(()=>l[12]||(l[12]=[m("取消")])),_:1,__:[12]}),t(H,{type:"primary",onClick:Q,loading:x.value},{default:o(()=>l[13]||(l[13]=[m(" 保存 ")])),_:1,__:[13]},8,["loading"])])]),default:o(()=>[d.value?(r(),y(K,{key:0,model:d.value,"label-width":"100px"},{default:o(()=>[t(g,{label:"课程标题"},{default:o(()=>[t(F,{modelValue:d.value.title,"onUpdate:modelValue":l[2]||(l[2]=p=>d.value.title=p)},null,8,["modelValue"])]),_:1}),t(g,{label:"课程描述"},{default:o(()=>[t(F,{modelValue:d.value.description,"onUpdate:modelValue":l[3]||(l[3]=p=>d.value.description=p),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(g,{label:"课程封面"},{default:o(()=>[t(J,{class:"cover-uploader",action:U.value.uploadUrl,data:U.value,"show-file-list":!1,"on-success":q,"before-upload":z},{default:o(()=>[d.value.coverImage?(r(),f("img",{key:0,src:d.value.coverImage,class:"cover-image-preview"},null,8,Xe)):(r(),y(B,{key:1,class:"cover-uploader-icon"},{default:o(()=>[t(C(ee))]),_:1}))]),_:1},8,["action","data"])]),_:1})]),_:1},8,["model"])):k("",!0)]),_:1},8,["modelValue"])]),u.courseId?(r(),y(Ie,{key:0,"course-id":u.courseId},null,8,["course-id"])):k("",!0)],64)}}},tt=ue(et,[["__scopeId","data-v-467ec75f"]]),ot=()=>Te.get("/reports/student/me"),st={class:"home-container"},lt={class:"content-wrapper"},at={key:0},nt={class:"section-header"},rt={class:"actions"},ut={key:0,class:"loading-container"},it=["src"],dt={class:"course-info"},ct={class:"teacher",style:{display:"inline"}},pt={class:"card-footer"},_t={key:1},vt={key:0},ft={key:1},mt={class:"stats-info"},yt={class:"stats-number"},gt={class:"stats-info"},Ct={class:"stats-number"},kt={class:"stats-info"},ht={class:"stats-number"},wt={class:"stats-compare"},bt={key:2},xt={class:"section-header"},Vt={key:0,class:"loading-container"},$t={class:"topic-info"},It={class:"topic-meta"},Dt={class:"topic-footer"},St={class:"topic-progress"},Tt={class:"progress-text"},Ut={class:"dialog-footer"},Lt={__name:"StudentHome",setup(de){const S=_e();ie();const h=c("courses"),b=c(""),T=c([]),w=c(!1);c("week");const d=c(null),x=c(!1),U=c(!1),O=c(null);let V=null;const L=c(!1),M=c(""),G=c(!1),N=c(""),Q=c(!1),A=c(!1),z=c([]),q=c(!1);ve(()=>{const a=S.currentRoute.value.query.tab;P(a||"courses"),window.addEventListener("resize",()=>{V&&V.resize()})});const te=()=>{j(!0)},j=async(a=!1)=>{if(!w.value){w.value=!0;try{const e=await Ae({page:1,size:10});T.value=e.list,a&&_.success("课程列表已刷新！")}catch(e){_.error("获取课程列表失败"),console.error(e)}finally{w.value=!1}}},u=fe(()=>{if(!b.value)return T.value;const a=b.value.toLowerCase();return T.value.filter(e=>e.title.toLowerCase().includes(a))}),l=async()=>{if(!x.value){x.value=!0;try{const a=await ot();d.value=a,U.value=!0,await ze(),setTimeout(()=>{B()},100)}catch(a){console.error("获取学习报告失败",a),_.error("获取学习报告失败")}finally{x.value=!1}}},B=()=>{if(O.value&&d.value&&d.value.studyTrend){V&&V.dispose(),V=Oe(O.value);const a=[];for(let g=29;g>=0;g--){const J=new Date;J.setDate(J.getDate()-g),a.push(J.toISOString().slice(0,10))}const e=new Map(d.value.studyTrend.map(g=>[g.date.slice(0,10),(g.duration||0).toFixed(1)])),I=a.map(g=>e.get(g)||0),E={tooltip:{trigger:"axis",formatter:"{b}: {c} 分钟"},xAxis:{type:"category",data:a,axisLabel:{rotate:30}},yAxis:{type:"value",name:"学习时长 (分钟)"},series:[{data:I,type:"line",smooth:!0}],grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0}};V.setOption(E)}},P=a=>{h.value=a,a==="courses"?T.value.length===0&&j():a==="reports"?l():a==="ai_playground"&&F()},oe=async()=>{if(!M.value){_.warning("请输入课程码");return}G.value=!0;try{await Ee({courseCode:M.value}),_.success("成功加入课程！"),L.value=!1,M.value="",await j()}catch(a){_.error(a.message||"加入课程失败")}finally{G.value=!1}},se=a=>{S.push(`/course/learn/${a}`)},F=async()=>{A.value=!0;try{const a=await Ue();z.value=a}catch{_.error("获取主题历史失败"),z.value=[]}finally{A.value=!1}},H=()=>{N.value="",q.value=!0},le=async()=>{var a,e;if(!N.value){_.warning("请输入知识点主题");return}Q.value=!0;try{await Je(N.value),_.success("新题目生成成功！"),q.value=!1,await F()}catch(I){_.error(((e=(a=I.response)==null?void 0:a.data)==null?void 0:e.message)||"题目生成失败，请稍后重试")}finally{Q.value=!1}},ae=a=>{S.push({name:"AiQuestionView",params:{batchId:a.batchId},query:{topic:a.topic}})},Y=a=>a.completedCount===0?{text:"待完成",type:"info"}:a.completedCount<a.totalCount?{text:"进行中",type:"warning"}:{text:"已完成",type:"success"};return Le(h,a=>{a==="reports"&&!d.value&&l()}),(a,e)=>{const I=n("el-icon"),E=n("el-menu-item"),g=n("el-menu"),J=n("el-aside"),K=n("el-input"),D=n("el-button"),p=n("el-skeleton"),$=n("el-card"),R=n("el-col"),Z=n("el-row"),ne=n("el-empty"),ge=n("el-progress"),Ce=n("el-tag"),ke=n("el-main"),he=n("el-form-item"),we=n("el-form"),ce=n("el-dialog");return r(),f("div",st,[s("div",lt,[t(J,{width:"240px",class:"sidebar"},{default:o(()=>[t(g,{"default-active":h.value,class:"menu",onSelect:P},{default:o(()=>[t(E,{index:"courses"},{default:o(()=>[t(I,null,{default:o(()=>[t(C(me))]),_:1}),e[8]||(e[8]=s("span",null,"我的课程",-1))]),_:1,__:[8]}),t(E,{index:"reports"},{default:o(()=>[t(I,null,{default:o(()=>[t(C(He))]),_:1}),e[9]||(e[9]=s("span",null,"学习报告",-1))]),_:1,__:[9]}),t(E,{index:"ai_playground"},{default:o(()=>[t(I,null,{default:o(()=>[t(C(Me))]),_:1}),e[10]||(e[10]=s("span",null,"AI练题",-1))]),_:1,__:[10]})]),_:1},8,["default-active"])]),_:1}),t(ke,{class:"main-content"},{default:o(()=>[h.value==="courses"?(r(),f("div",at,[s("div",nt,[e[12]||(e[12]=s("h2",null,"我的课程",-1)),s("div",rt,[t(K,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=i=>b.value=i),placeholder:"搜索课程",class:"search-input","prefix-icon":C(ye),clearable:""},null,8,["modelValue","prefix-icon"]),t(D,{type:"primary",icon:C(ee),onClick:e[1]||(e[1]=i=>L.value=!0)},{default:o(()=>e[11]||(e[11]=[m("加入课程")])),_:1,__:[11]},8,["icon"]),t(D,{icon:C(Ne),circle:"",onClick:te,loading:w.value},null,8,["icon","loading"])])]),w.value?(r(),f("div",ut,[t(p,{rows:5,animated:""})])):(r(),f(X,{key:1},[u.value.length>0?(r(),y(Z,{key:0,gutter:20},{default:o(()=>[(r(!0),f(X,null,re(u.value,i=>(r(),y(R,{span:6,key:i.id},{default:o(()=>[t($,{class:"course-card","body-style":{padding:"0px"},onClick:be=>se(i.id)},{default:o(()=>[s("img",{src:i.coverImage,class:"course-image"},null,8,it),s("div",dt,[s("h3",null,v(i.title),1),e[13]||(e[13]=m(" 教学老师：")),s("h4",ct,v(i.teacherName),1)]),s("div",pt,[t(D,{type:"primary",link:"",class:"action-btn"},{default:o(()=>e[14]||(e[14]=[m("进入学习")])),_:1,__:[14]})])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})):(r(),y(ne,{key:1,description:"暂无课程"}))],64))])):k("",!0),h.value==="reports"?(r(),f("div",_t,[e[22]||(e[22]=s("div",{class:"section-header"},[s("h2",null,"学习报告")],-1)),x.value?(r(),f("div",vt,[t(p,{rows:5,animated:""})])):k("",!0),!x.value&&d.value?(r(),f("div",ft,[t(Z,{gutter:20},{default:o(()=>[t(R,{span:8},{default:o(()=>[t($,{class:"report-card"},{header:o(()=>e[15]||(e[15]=[s("div",{class:"card-header"},[s("span",null,"总学习时长")],-1)])),default:o(()=>[s("div",mt,[s("div",yt,[m(v((d.value.totalStudyDurationMinutes||0).toFixed(1)),1),e[16]||(e[16]=s("span",{class:"stats-unit"},"分钟",-1))])])]),_:1})]),_:1}),t(R,{span:8},{default:o(()=>[t($,{class:"report-card"},{header:o(()=>e[17]||(e[17]=[s("div",{class:"card-header"},[s("span",null,"课程完成情况")],-1)])),default:o(()=>[s("div",gt,[s("div",Ct,v(d.value.completedCoursesCount||0)+" / "+v(d.value.totalCoursesCount||0),1),e[18]||(e[18]=s("div",{class:"stats-compare"},"已完成课程数 / 总课程数",-1))])]),_:1})]),_:1}),t(R,{span:8},{default:o(()=>[t($,{class:"report-card"},{header:o(()=>e[19]||(e[19]=[s("div",{class:"card-header"},[s("span",null,"作业平均分")],-1)])),default:o(()=>[s("div",kt,[s("div",ht,[m(v((d.value.averageScore||0).toFixed(1)),1),e[20]||(e[20]=s("span",{class:"stats-unit"},"分",-1))]),s("div",wt,"已完成 "+v(d.value.completedHomeworkCount||0)+" / "+v(d.value.totalHomeworkCount||0)+" 个作业",1)])]),_:1})]),_:1})]),_:1}),t(Z,{gutter:20,class:"mt-20"},{default:o(()=>[t(R,{span:24},{default:o(()=>[t($,{class:"report-card"},{header:o(()=>e[21]||(e[21]=[s("div",{class:"card-header"},[s("span",null,"近30日学习趋势")],-1)])),default:o(()=>[s("div",{ref_key:"studyTrendChart",ref:O,class:"chart-container large"},null,512)]),_:1})]),_:1})]),_:1})])):k("",!0),!x.value&&!d.value?(r(),y(ne,{key:2,description:"暂无学习报告数据"})):k("",!0)])):k("",!0),h.value==="ai_playground"?(r(),f("div",bt,[s("div",xt,[e[24]||(e[24]=s("h2",null,"AI练题 - 练习主题",-1)),t(D,{type:"primary",icon:C(ee),onClick:H},{default:o(()=>e[23]||(e[23]=[m("生成新题目")])),_:1,__:[23]},8,["icon"])]),A.value?(r(),f("div",Vt,[t(p,{rows:5,animated:""})])):k("",!0),!A.value&&z.value.length>0?(r(),y(Z,{key:1,gutter:20},{default:o(()=>[(r(!0),f(X,null,re(z.value,i=>(r(),y(R,{span:6,key:i.batchId},{default:o(()=>[t($,{class:"topic-card",onClick:be=>ae(i)},{default:o(()=>[s("div",$t,[s("h3",null,v(i.topic),1),s("p",It," 创建于 "+v(new Date(i.createdAt).toLocaleDateString()),1)]),s("div",Dt,[s("div",St,[t(ge,{percentage:i.totalCount>0?i.completedCount/i.totalCount*100:0,"show-text":!1},null,8,["percentage"]),s("span",Tt,v(i.completedCount)+" / "+v(i.totalCount)+" 题",1)]),t(Ce,{type:Y(i).type,size:"small"},{default:o(()=>[m(v(Y(i).text),1)]),_:2},1032,["type"])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})):k("",!0),!A.value&&z.value.length===0?(r(),y(ne,{key:2,description:"您还没有生成过题目，快去生成新的题目吧！"})):k("",!0)])):k("",!0)]),_:1})]),t(ce,{modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=i=>L.value=i),title:"加入新课程",width:"400px"},{footer:o(()=>[s("span",Ut,[t(D,{onClick:e[4]||(e[4]=i=>L.value=!1)},{default:o(()=>e[25]||(e[25]=[m("取消")])),_:1,__:[25]}),t(D,{type:"primary",onClick:oe,loading:G.value},{default:o(()=>e[26]||(e[26]=[m(" 立即加入 ")])),_:1,__:[26]},8,["loading"])])]),default:o(()=>[t(we,{onSubmit:e[3]||(e[3]=W(()=>{},["prevent"]))},{default:o(()=>[t(he,{label:"课程码"},{default:o(()=>[t(K,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=i=>M.value=i),placeholder:"请输入教师提供的6位课程码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ce,{modelValue:q.value,"onUpdate:modelValue":e[7]||(e[7]=i=>q.value=i),title:"生成新题目",width:"500px"},{default:o(()=>[t(K,{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=i=>N.value=i),placeholder:"请输入您想练习的知识点，例如：Java并发、二叉树",class:"topic-input"},{append:o(()=>[t(D,{onClick:le,loading:Q.value},{default:o(()=>e[27]||(e[27]=[m("立即生成")])),_:1,__:[27]},8,["loading"])]),_:1},8,["modelValue"]),e[28]||(e[28]=s("p",{class:"dialog-tip"},"生成成功后，请关闭对话框查看您的新题目列表。",-1))]),_:1,__:[28]},8,["modelValue"])])}}},Ht=ue(Lt,[["__scopeId","data-v-97920a49"]]),Mt={class:"home"},Nt={__name:"Home",setup(de){const S=ie();return(h,b)=>(r(),f("div",Mt,[C(S).isTeacher?(r(),y(tt,{key:0})):(r(),y(Ht,{key:1}))]))}},zt=ue(Nt,[["__scopeId","data-v-d4ecbd66"]]);export{zt as default};
