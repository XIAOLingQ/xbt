import{_ as O,W as R,r as c,i as j,$ as J,E as k,m as V,c as r,b as d,w as g,e as u,f as P,o,d as n,y as a,F as W,x as $,p as _,h as p,a0 as z}from"./index-ChKRIHQI.js";const K={class:"submission-grading-container"},Q={class:"text-large font-600 mr-3"},X={key:0},Y={key:1},Z={class:"score-text"},q={key:0,class:"answer-block"},ee={key:1,class:"answer-block"},te={class:"answer-section"},se=["innerHTML"],ne={key:1,class:"attachment"},re=["href"],oe={key:2},ae={class:"answer-section"},le={key:0},ie={key:0,class:"answer-content"},ce={key:1,class:"attachment"},de=["href"],ue={key:1},_e={key:2,class:"grading-input"},me={class:"footer-actions"},pe={class:"total-score"},fe={__name:"SubmissionGrading",setup(ve){const I=R(),b=P(),S=I.params.submissionId,x=c(!0),w=c(!1),y=c({}),m=c([]),T=c({}),f=c({});j(async()=>{try{const s=await J(S);y.value={homeworkTitle:s.homeworkTitle,studentName:s.studentName},m.value=s.questions,T.value=s.studentAnswers,m.value.forEach(e=>{e.questionType!=="choice"&&(f.value[e.id]=0)})}catch{k.error("获取提交详情失败")}finally{x.value=!1}});const v=s=>T.value[s]||"未作答",i=s=>{const e=v(s);if(e==="未作答")return{};if(typeof e=="object"&&e!==null)return e;if(typeof e=="string")try{return JSON.parse(e)||{}}catch{return{text:e}}return{}},l=s=>{if(!s)return{};try{return JSON.parse(s)||{}}catch{return{}}},D=s=>typeof s!="string"?"":s.replace(/\\n/g,"<br>"),F=V(()=>m.value.reduce((s,e)=>s+parseInt(e.score||0),0)),N=V(()=>{let s=0;return m.value.forEach(e=>{e.questionType==="choice"?String(v(e.id))===String(e.answer)&&(s+=parseInt(e.score||0)):s+=f.value[e.id]||0}),s}),A=async()=>{w.value=!0;try{await z(S,{finalScore:N.value}),k.success("批改成功!"),b.back()}catch{k.error("提交批改失败")}finally{w.value=!1}},B=()=>{b.back()};return(s,e)=>{const h=u("el-page-header"),E=u("el-input-number"),U=u("el-form-item"),C=u("el-divider"),M=u("el-button"),G=u("el-card");return o(),r("div",K,[d(h,{onBack:B},{content:g(()=>[n("span",Q," 作业批改: "+a(y.value.homeworkTitle)+" - "+a(y.value.studentName),1)]),_:1}),d(G,{class:"box-card"},{default:g(()=>[x.value?(o(),r("div",X,"加载中...")):(o(),r("div",Y,[(o(!0),r(W,null,$(m.value,(t,L)=>(o(),r("div",{key:t.id,class:"question-item"},[n("h4",null,[p(a(L+1)+". "+a(t.questionText)+" ",1),n("span",Z,"(分值: "+a(t.score)+")",1)]),t.questionType==="choice"?(o(),r("div",q,[n("p",null,[e[0]||(e[0]=n("strong",null,"正确答案:",-1)),p(" "+a(t.answer),1)]),n("p",null,[e[1]||(e[1]=n("strong",null,"学生答案:",-1)),p(" "+a(v(t.id)),1)])])):(o(),r("div",ee,[n("div",te,[e[3]||(e[3]=n("strong",null,"参考答案:",-1)),l(t.answer).answerDescription?(o(),r("div",{key:0,innerHTML:D(l(t.answer).answerDescription),class:"answer-content"},null,8,se)):_("",!0),l(t.answer).answerFileUrl?(o(),r("div",ne,[e[2]||(e[2]=n("strong",null,"附件: ",-1)),n("a",{href:l(t.answer).answerFileUrl,target:"_blank"},a(l(t.answer).answerFileName||"点击下载"),9,re)])):_("",!0),!l(t.answer).answerDescription&&!l(t.answer).answerFileUrl?(o(),r("p",oe,"该题没有提供参考答案")):_("",!0)]),n("div",ae,[e[5]||(e[5]=n("strong",null,"学生答案:",-1)),v(t.id)!=="未作答"?(o(),r("div",le,[i(t.id).text?(o(),r("div",ie,a(i(t.id).text),1)):_("",!0),i(t.id).file&&i(t.id).file.url?(o(),r("div",ce,[e[4]||(e[4]=n("strong",null,"附件: ",-1)),n("a",{href:i(t.id).file.url,target:"_blank"},a(i(t.id).file.name),9,de)])):_("",!0)])):(o(),r("p",ue,"未作答"))])])),t.questionType!=="choice"?(o(),r("div",_e,[d(U,{label:"打分"},{default:g(()=>[d(E,{modelValue:f.value[t.id],"onUpdate:modelValue":H=>f.value[t.id]=H,min:0,max:parseInt(t.score||0)},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)])):_("",!0),d(C)]))),128)),n("div",me,[n("div",pe,[e[6]||(e[6]=n("strong",null,"总分: ",-1)),p(" "+a(N.value)+" / "+a(F.value),1)]),d(M,{type:"primary",onClick:A,loading:w.value},{default:g(()=>e[7]||(e[7]=[p("提交批改")])),_:1,__:[7]},8,["loading"])])]))]),_:1})])}}},we=O(fe,[["__scopeId","data-v-edf8dfc2"]]);export{we as default};
